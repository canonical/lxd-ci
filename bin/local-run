#!/bin/sh
set -ux

script="${1}"
lxd_snap_channel="${2}"
shift 2
test_name="$(basename "${script}")"
_script="$(mktemp "${test_name}.XXXX")"

echo "==> Running the job ${test_name} against ${lxd_snap_channel}" >&2
sed "1 r bin/helpers" "${script}" | sed "s|^@@LXD_SNAP_CHANNEL@@$|LXD_SNAP_CHANNEL=${lxd_snap_channel}|" > "${_script}"
exec bash "${_script}" "${@}"
